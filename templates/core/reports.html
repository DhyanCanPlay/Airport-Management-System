{% extends 'base.html' %}

{% block title %}Reports - Airport Management System{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <h1>
            <i class="fas fa-chart-bar"></i> Reports & Analytics
        </h1>
        <p class="text-muted">Comprehensive insights and data visualization</p>
    </div>
</div>

<!-- Summary Statistics -->
<div class="row mb-5">
    <div class="col-md-3 mb-3">
        <div class="card text-center border-primary">
            <div class="card-body">
                <i class="fas fa-plane fa-3x text-primary mb-3"></i>
                <h2 class="text-primary">{{ total_flights }}</h2>
                <p class="card-text">Total Flights</p>
            </div>
        </div>
    </div>
    <div class="col-md-3 mb-3">
        <div class="card text-center border-success">
            <div class="card-body">
                <i class="fas fa-users fa-3x text-success mb-3"></i>
                <h2 class="text-success">{{ total_passengers }}</h2>
                <p class="card-text">Passengers</p>
            </div>
        </div>
    </div>
    <div class="col-md-3 mb-3">
        <div class="card text-center border-warning">
            <div class="card-body">
                <i class="fas fa-ticket-alt fa-3x text-warning mb-3"></i>
                <h2 class="text-warning">{{ total_bookings }}</h2>
                <p class="card-text">Bookings</p>
            </div>
        </div>
    </div>
    <div class="col-md-3 mb-3">
        <div class="card text-center border-info">
            <div class="card-body">
                <i class="fas fa-user-tie fa-3x text-info mb-3"></i>
                <h2 class="text-info">{{ total_staff }}</h2>
                <p class="card-text">Staff Members</p>
            </div>
        </div>
    </div>
</div>

<!-- Charts Section -->
<div class="row mb-5">
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-map-marker-alt"></i> Top Flight Destinations
                </h5>
            </div>
            <div class="card-body">
                <canvas id="destinationsChart" width="400" height="300"></canvas>
            </div>
            <div class="card-footer">
                <button class="btn btn-outline-primary btn-sm" onclick="refreshChart('destinations')">
                    <i class="fas fa-sync"></i> Refresh
                </button>
            </div>
        </div>
    </div>
    
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-chart-pie"></i> Booking Status Distribution
                </h5>
            </div>
            <div class="card-body">
                <canvas id="bookingsChart" width="400" height="300"></canvas>
            </div>
            <div class="card-footer">
                <button class="btn btn-outline-primary btn-sm" onclick="refreshChart('bookings')">
                    <i class="fas fa-sync"></i> Refresh
                </button>
            </div>
        </div>
    </div>
</div>

<div class="row mb-5">
    <div class="col-md-12 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-users"></i> Passenger Age Distribution
                </h5>
            </div>
            <div class="card-body">
                <canvas id="ageChart" width="800" height="400"></canvas>
            </div>
            <div class="card-footer">
                <button class="btn btn-outline-primary btn-sm" onclick="refreshChart('age_distribution')">
                    <i class="fas fa-sync"></i> Refresh
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Data Tables -->
<div class="row">
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-list"></i> Booking Statistics
                </h5>
            </div>
            <div class="card-body">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Status</th>
                            <th>Count</th>
                            <th>Percentage</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for stat in booking_stats %}
                        <tr>
                            <td>
                                <span class="badge bg-{% if stat.status == 'confirmed' %}success{% elif stat.status == 'pending' %}warning{% else %}danger{% endif %}">
                                    {{ stat.status|title }}
                                </span>
                            </td>
                            <td>{{ stat.count }}</td>
                            <td>
                                {% widthratio stat.count total_bookings 100 %}%
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-plane"></i> Popular Destinations
                </h5>
            </div>
            <div class="card-body">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Destination</th>
                            <th>Flights</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for dest in destination_stats %}
                        <tr>
                            <td>{{ dest.arrival_city }}</td>
                            <td>
                                <span class="badge bg-primary">{{ dest.count }}</span>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Export Options -->
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-download"></i> Export Reports
                </h5>
            </div>
            <div class="card-body">
                <p>Export detailed reports for analysis and documentation:</p>
                <div class="btn-group" role="group">
                    <button type="button" class="btn btn-outline-primary" onclick="alert('PDF export would be implemented here')">
                        <i class="fas fa-file-pdf"></i> Export PDF
                    </button>
                    <button type="button" class="btn btn-outline-success" onclick="alert('Excel export would be implemented here')">
                        <i class="fas fa-file-excel"></i> Export Excel
                    </button>
                    <button type="button" class="btn btn-outline-info" onclick="alert('CSV export would be implemented here')">
                        <i class="fas fa-file-csv"></i> Export CSV
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Initialize charts
document.addEventListener('DOMContentLoaded', function() {
    loadChart('destinations');
    loadChart('bookings');
    loadChart('age_distribution');
});

function loadChart(chartType) {
    fetch(`/charts/${chartType}/`)
        .then(response => response.json())
        .then(data => {
            const img = new Image();
            img.onload = function() {
                const canvas = document.getElementById(getCanvasId(chartType));
                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
            };
            img.src = 'data:image/png;base64,' + data.image;
        })
        .catch(error => {
            console.error('Error loading chart:', error);
        });
}

function getCanvasId(chartType) {
    switch(chartType) {
        case 'destinations':
            return 'destinationsChart';
        case 'bookings':
            return 'bookingsChart';
        case 'age_distribution':
            return 'ageChart';
        default:
            return 'chart';
    }
}

function refreshChart(chartType) {
    const canvas = document.getElementById(getCanvasId(chartType));
    const ctx = canvas.getContext('2d');
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = '#f8f9fa';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = '#6c757d';
    ctx.font = '16px Arial';
    ctx.textAlign = 'center';
    ctx.fillText('Loading...', canvas.width/2, canvas.height/2);
    
    setTimeout(() => loadChart(chartType), 1000);
}
</script>
{% endblock %}
