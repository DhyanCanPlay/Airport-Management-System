{% extends 'base.html' %}
{% load static %}

{% block title %}Flight Booking & Travel Portal - Modern Airport Experience{% endblock %}

{% block extra_css %}
<style>
    :root {
        --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        --card-shadow: 0 10px 30px rgba(0,0,0,0.1);
        --hover-shadow: 0 20px 60px rgba(0,0,0,0.15);
    }

    body {
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    }

    .hero-modern {
        background: var(--primary-gradient);
        border-radius: 20px;
        padding: 3rem;
        color: white;
        position: relative;
        overflow: hidden;
        margin-bottom: 2rem;
    }

    .hero-modern::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 1000"><defs><radialGradient id="a" cx="50%" cy="50%"><stop offset="0%" stop-color="white" stop-opacity="0.1"/><stop offset="100%" stop-color="white" stop-opacity="0"/></radialGradient></defs><circle cx="200" cy="200" r="100" fill="url(%23a)"/><circle cx="800" cy="300" r="150" fill="url(%23a)"/><circle cx="600" cy="700" r="120" fill="url(%23a)"/></svg>');
        opacity: 0.3;
    }

    .hero-content {
        position: relative;
        z-index: 2;
    }

    .modern-card {
        background: white;
        border-radius: 16px;
        padding: 2rem;
        box-shadow: var(--card-shadow);
        border: none;
        transition: all 0.3s ease;
        height: 100%;
    }

    .modern-card:hover {
        transform: translateY(-5px);
        box-shadow: var(--hover-shadow);
    }

    .feature-icon {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 1rem;
        font-size: 1.5rem;
        color: white;
    }

    .icon-booking { background: var(--primary-gradient); }
    .icon-checkin { background: var(--success-gradient); }
    .icon-status { background: var(--secondary-gradient); }
    .icon-loyalty { background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%); }

    .search-card {
        background: white;
        border-radius: 20px;
        padding: 2.5rem;
        box-shadow: var(--card-shadow);
        border: none;
    }

    .form-control {
        border-radius: 12px;
        border: 2px solid #e9ecef;
        padding: 0.75rem 1rem;
        font-size: 1rem;
        transition: all 0.3s ease;
    }

    .form-control:focus {
        border-color: #667eea;
        box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
    }

    .btn-modern {
        background: var(--primary-gradient);
        border: none;
        border-radius: 12px;
        padding: 0.75rem 2rem;
        font-weight: 600;
        color: white;
        transition: all 0.3s ease;
    }

    .btn-modern:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        color: white;
    }

    .flight-card {
        background: white;
        border-radius: 16px;
        padding: 1.5rem;
        margin-bottom: 1rem;
        box-shadow: var(--card-shadow);
        border: none;
        transition: all 0.3s ease;
    }

    .flight-card:hover {
        transform: translateY(-3px);
        box-shadow: var(--hover-shadow);
    }

    .price-tag {
        background: var(--success-gradient);
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 25px;
        font-weight: 600;
        font-size: 1.1rem;
    }

    .status-badge {
        padding: 0.4rem 1rem;
        border-radius: 20px;
        font-weight: 600;
        font-size: 0.85rem;
    }

    .status-ontime { background: #d4edda; color: #155724; }
    .status-delayed { background: #fff3cd; color: #856404; }
    .status-boarding { background: #cce5ff; color: #004085; }

    .stats-card {
        text-align: center;
        background: white;
        border-radius: 16px;
        padding: 1.5rem;
        box-shadow: var(--card-shadow);
        border: none;
    }

    .stats-number {
        font-size: 2.5rem;
        font-weight: 700;
        background: var(--primary-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .floating-nav {
        position: fixed;
        bottom: 2rem;
        right: 2rem;
        z-index: 1000;
    }

    .nav-fab {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: var(--primary-gradient);
        border: none;
        color: white;
        font-size: 1.5rem;
        box-shadow: var(--card-shadow);
        transition: all 0.3s ease;
        margin-bottom: 0.5rem;
        display: block;
    }

    .nav-fab:hover {
        transform: scale(1.1);
        box-shadow: var(--hover-shadow);
        color: white;
    }

    .glassmorphism {
        background: rgba(255, 255, 255, 0.25);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.18);
    }

    @media (max-width: 768px) {
        .hero-modern {
            padding: 2rem;
            margin: 1rem;
        }
        
        .search-card {
            padding: 1.5rem;
            margin: 1rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Modern Hero Section -->
<div class="container-fluid px-4">
    <div class="hero-modern">
        <div class="hero-content">
            <div class="row align-items-center">
                <div class="col-lg-8">
                    <h1 class="display-4 fw-bold mb-3">
                        ‚úàÔ∏è Your Journey Starts Here
                    </h1>
                    <p class="lead mb-4 opacity-90">
                        Discover destinations, book flights, and manage your travel experience with our modern, intuitive platform.
                    </p>
                    {% if user.is_authenticated %}
                        <div class="d-flex align-items-center">
                            <div class="me-3">
                                <img src="https://ui-avatars.com/api/?name={{ user.get_full_name|default:user.username }}&background=ffffff&color=667eea&size=50" 
                                     class="rounded-circle" alt="Profile">
                            </div>
                            <div>
                                <h5 class="mb-1">Welcome back, {{ user.get_full_name|default:user.username }}!</h5>
                                <p class="mb-0 opacity-75">Ready for your next adventure?</p>
                            </div>
                        </div>
                    {% endif %}
                </div>
                <div class="col-lg-4 text-center">
                    <div class="glassmorphism rounded-3 p-4">
                        <h5 class="mb-3">Live Airport Stats</h5>
                        <div class="row">
                            <div class="col-4">
                                <div class="stats-number">{{ upcoming_flights|length }}</div>
                                <small>Departures Today</small>
                            </div>
                            <div class="col-4">
                                <div class="stats-number">{{ user_bookings|length }}</div>
                                <small>Your Bookings</small>
                            </div>
                            <div class="col-4">
                                <div class="stats-number">95</div>
                                <small>On-Time %</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Flight Search Section -->
<div class="container mb-5">
    <div class="search-card">
        <h3 class="text-center mb-4 fw-bold">üîç Find Your Perfect Flight</h3>
        <form method="GET" action="{% url 'customer:flight_search' %}">
            <div class="row g-3">
                <div class="col-md-3">
                    <label class="form-label fw-semibold">From</label>
                    <input type="text" class="form-control" name="from" placeholder="Departure City" required>
                </div>
                <div class="col-md-3">
                    <label class="form-label fw-semibold">To</label>
                    <input type="text" class="form-control" name="to" placeholder="Destination City" required>
                </div>
                <div class="col-md-2">
                    <label class="form-label fw-semibold">Departure</label>
                    <input type="date" class="form-control" name="departure_date" required>
                </div>
                <div class="col-md-2">
                    <label class="form-label fw-semibold">Passengers</label>
                    <select class="form-control" name="passengers">
                        <option value="1">1 Adult</option>
                        <option value="2">2 Adults</option>
                        <option value="3">3 Adults</option>
                        <option value="4">4+ Adults</option>
                    </select>
                </div>
                <div class="col-md-2 d-flex align-items-end">
                    <button type="submit" class="btn btn-modern w-100">
                        <i class="fas fa-search me-2"></i>Search
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- Feature Cards -->
<div class="container mb-5">
    <h2 class="text-center fw-bold mb-5">‚ú® Everything You Need</h2>
    <div class="row g-4">
        <div class="col-lg-3 col-md-6">
            <div class="modern-card text-center">
                <div class="feature-icon icon-booking">
                    <i class="fas fa-ticket-alt"></i>
                </div>
                <h5 class="fw-bold mb-3">Easy Booking</h5>
                <p class="text-muted mb-4">Book flights in seconds with our streamlined process. Compare prices and find the best deals.</p>
                <a href="{% url 'customer:flight_search' %}" class="btn btn-outline-primary btn-sm">Book Now</a>
            </div>
        </div>
        <div class="col-lg-3 col-md-6">
            <div class="modern-card text-center">
                <div class="feature-icon icon-checkin">
                    <i class="fas fa-mobile-alt"></i>
                </div>
                <h5 class="fw-bold mb-3">Mobile Check-in</h5>
                <p class="text-muted mb-4">Skip the lines! Check in online and get your boarding pass delivered instantly.</p>
                <a href="{% url 'customer:my_bookings' %}" class="btn btn-outline-success btn-sm">Check-in</a>
            </div>
        </div>
        <div class="col-lg-3 col-md-6">
            <div class="modern-card text-center">
                <div class="feature-icon icon-status">
                    <i class="fas fa-radar"></i>
                </div>
                <h5 class="fw-bold mb-3">Live Tracking</h5>
                <p class="text-muted mb-4">Real-time flight updates, gate changes, and delay notifications sent directly to you.</p>
                <a href="{% url 'customer:flight_status' %}" class="btn btn-outline-danger btn-sm">Track Flight</a>
            </div>
        </div>
        <div class="col-lg-3 col-md-6">
            <div class="modern-card text-center">
                <div class="feature-icon icon-loyalty">
                    <i class="fas fa-crown"></i>
                </div>
                <h5 class="fw-bold mb-3">Rewards Program</h5>
                <p class="text-muted mb-4">Earn points on every flight and unlock exclusive benefits and priority services.</p>
                <a href="{% url 'customer:loyalty_program' %}" class="btn btn-outline-warning btn-sm">Join Now</a>
            </div>
        </div>
    </div>
</div>

<!-- Live Departures -->
<div class="container mb-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="fw-bold">üõ´ Live Departures</h2>
        <a href="{% url 'customer:flight_status' %}" class="btn btn-outline-primary">View All</a>
    </div>
    
    {% if upcoming_flights %}
        <div class="row">
            {% for flight in upcoming_flights %}
            <div class="col-12">
                <div class="flight-card">
                    <div class="row align-items-center">
                        <div class="col-md-2">
                            <div class="text-center">
                                <h5 class="fw-bold mb-1">{{ flight.flight_number }}</h5>
                                <small class="text-muted">{{ flight.airline }}</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="d-flex align-items-center justify-content-center">
                                <div class="text-center me-3">
                                    <div class="fw-bold">{{ flight.departure_time|date:"H:i" }}</div>
                                    <small class="text-muted">{{ flight.departure_city }}</small>
                                </div>
                                <div class="mx-3">
                                    <i class="fas fa-plane text-primary"></i>
                                </div>
                                <div class="text-center ms-3">
                                    <div class="fw-bold">{{ flight.arrival_time|date:"H:i" }}</div>
                                    <small class="text-muted">{{ flight.arrival_city }}</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-2 text-center">
                            <span class="status-badge status-ontime">On Time</span>
                        </div>
                        <div class="col-md-2 text-center">
                            <small class="text-muted">Gate</small>
                            <div class="fw-bold">{{ flight.gate_number|default:"TBD" }}</div>
                        </div>
                        <div class="col-md-2 text-center">
                            <div class="price-tag">‚Çπ{{ flight.price }}</div>
                        </div>
                        <div class="col-md-1 text-center">
                            <a href="{% url 'customer:make_booking' flight.id %}" class="btn btn-modern btn-sm">Book</a>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="modern-card text-center py-5">
            <i class="fas fa-plane fa-3x text-muted mb-3"></i>
            <h5 class="text-muted">No departures in the next few hours</h5>
            <p class="text-muted">Check back later or search for flights to your destination</p>
        </div>
    {% endif %}
</div>

<!-- Your Bookings -->
{% if user.is_authenticated and user_bookings %}
<div class="container mb-5">
    <h2 class="fw-bold mb-4">üé´ Your Recent Bookings</h2>
    <div class="row">
        {% for booking in user_bookings %}
        <div class="col-md-6 mb-3">
            <div class="modern-card">
                <div class="d-flex justify-content-between align-items-start mb-3">
                    <div>
                        <h6 class="fw-bold">{{ booking.flight.flight_number }}</h6>
                        <small class="text-muted">{{ booking.flight.airline }}</small>
                    </div>
                    <span class="badge bg-success">Confirmed</span>
                </div>
                <div class="row">
                    <div class="col-6">
                        <small class="text-muted">Route</small>
                        <div class="fw-semibold">{{ booking.flight.departure_city }} ‚Üí {{ booking.flight.arrival_city }}</div>
                    </div>
                    <div class="col-6">
                        <small class="text-muted">Date</small>
                        <div class="fw-semibold">{{ booking.flight.departure_time|date:"M d, Y" }}</div>
                    </div>
                </div>
                <div class="d-flex justify-content-between align-items-center mt-3">
                    <span class="text-muted">Booking: {{ booking.booking_reference }}</span>
                    <a href="{% url 'customer:booking_detail' booking.booking_reference %}" class="btn btn-outline-primary btn-sm">Manage</a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

<!-- Floating Navigation -->
<div class="floating-nav">
    <a href="{% url 'customer:my_bookings' %}" class="nav-fab" title="Check-in">
        <i class="fas fa-check"></i>
    </a>
    <a href="{% url 'customer:loyalty_program' %}" class="nav-fab" title="Rewards">
        <i class="fas fa-star"></i>
    </a>
    <a href="{% url 'customer:help_center' %}" class="nav-fab" title="Support">
        <i class="fas fa-headset"></i>
    </a>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Set today's date as default for departure date
    const today = new Date().toISOString().split('T')[0];
    const departureDateInput = document.querySelector('input[name="departure_date"]');
    if (departureDateInput) {
        departureDateInput.value = today;
    }

    // Smooth scroll for anchor links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            document.querySelector(this.getAttribute('href')).scrollIntoView({
                behavior: 'smooth'
            });
        });
    });

    // Add loading state to search button
    const searchForm = document.querySelector('form');
    if (searchForm) {
        searchForm.addEventListener('submit', function() {
            const submitBtn = this.querySelector('button[type="submit"]');
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Searching...';
            submitBtn.disabled = true;
        });
    }

    // Animate stats on scroll
    const animateOnScroll = () => {
        const statsNumbers = document.querySelectorAll('.stats-number');
        statsNumbers.forEach(stat => {
            const rect = stat.getBoundingClientRect();
            if (rect.top < window.innerHeight && rect.bottom > 0) {
                stat.style.animation = 'countUp 1s ease-out';
            }
        });
    };

    window.addEventListener('scroll', animateOnScroll);
    animateOnScroll(); // Run once on load
});
</script>

<style>
@keyframes countUp {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}
</style>
{% endblock %}
